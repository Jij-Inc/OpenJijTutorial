
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>3-Plus-Annealing Cloud Web (NEDOのCMOS-Annealer) &#8212; OpenJij Tutorial  documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3-PyQUBO with OpenJij" href="3-PyQUBO_2_OpenJij.html" />
    <link rel="prev" title="ベンチマーク関数 標準誤差機能 の使い方" href="2-Evaluation_errorbar.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="3-PyQUBO_2_OpenJij.html" title="3-PyQUBO with OpenJij"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="2-Evaluation_errorbar.html" title="ベンチマーク関数 標準誤差機能 の使い方"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OpenJij Tutorial  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">OpenJij チュートリアル</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3-Plus-Annealing Cloud Web (NEDOのCMOS-Annealer)</a><ul>
<li><a class="reference internal" href="#token-取得">token 取得</a></li>
<li><a class="reference internal" href="#OpenJij-でアクセスする">OpenJij でアクセスする</a><ul>
<li><a class="reference internal" href="#相互作用とキンググラフ">相互作用とキンググラフ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#他のSamplerと同じ-辞書型で渡す">他のSamplerと同じ 辞書型で渡す</a></li>
<li><a class="reference internal" href="#キンググラフ上の2次元座標で相互作用を渡す">キンググラフ上の2次元座標で相互作用を渡す</a></li>
<li><a class="reference internal" href="#QUBOを解く">QUBOを解く</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="2-Evaluation_errorbar.html"
                        title="previous chapter">ベンチマーク関数 標準誤差機能 の使い方</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="3-PyQUBO_2_OpenJij.html"
                        title="next chapter">3-PyQUBO with OpenJij</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ja/3-Plus-CMOSAnnealer.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="3-Plus-Annealing-Cloud-Web-(NEDOのCMOS-Annealer)">
<h1>3-Plus-Annealing Cloud Web (NEDOのCMOS-Annealer)<a class="headerlink" href="#3-Plus-Annealing-Cloud-Web-(NEDOのCMOS-Annealer)" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/OpenJij/OpenJijTutorial/blob/master/ja/3-plus-CMOSAnnealer.ipynb"><img alt="Open in Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>ここでは 日立 の作った「CMOSアニーリングマシン」をWeb APIで提供している NEDO の <a class="reference external" href="https://annealing-cloud.com">Annealing Cloud Web</a> へ OpenJijを通して接続して CMOS アニーラを使ってみます。</p>
<blockquote>
<div><div class="line-block">
<div class="line">OpenJijによるサポートは接続先のAnnealing Cloud Web自体の永続性を保証するものではなく、予告なくサービス終了や内容の変更が生じる可能性があります。 このノートブックは 2019/4/26 に作成されました。</div>
<div class="line">またAnnealing Cloud Webの提供しているWeb APIは日立CMOSアニーリングマシン全体をサポートする標準的な仕様というわけではなく、実装例です。OpenJijではAnnealing Cloud WebのWeb APIで提供しているCMOSアニーリングマシンの機能にアクセスすることができます。</div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">Annealing Cloud Web については<a class="reference external" href="https://annealing-cloud.com">ここ</a>を見てください。</div>
<div class="line">OpenJijではAnnealing Cloud Web の公開している Web API をラップし、OpenJijの他のサンプラー(SASamplerやSQASampler)と同じインターフェースで提供しています。</div>
</div>
<div class="section" id="token-取得">
<h2>token 取得<a class="headerlink" href="#token-取得" title="Permalink to this headline">¶</a></h2>
<p>Annealing cloud web を使うには tokenを発行する必要があります。 <a class="reference external" href="https://annealing-cloud.com/web-api/token-request.html">https://annealing-cloud.com/web-api/token-request.html</a> ここから問い合わせれば取得できます。</p>
</div>
<div class="section" id="OpenJij-でアクセスする">
<h2>OpenJij でアクセスする<a class="headerlink" href="#OpenJij-でアクセスする" title="Permalink to this headline">¶</a></h2>
<p>では早速にコード例を示します。</p>
<p>まずopenjij をインストールしておきましょう</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># !pip install openjij</span>
<span class="o">!</span>pip show openjij  # <span class="nv">openjij</span> <span class="o">==</span> <span class="m">0</span>.0.5 を仮定します
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Name: openjij
Version: 0.0.5
Summary: Framework for ising model and QUBO
Home-page: https://openjij.github.io/OpenJij/
Author: Jij Inc.
Author-email: openjij@j-ij.com
License: Apache License 2.0
Location: /usr/local/miniconda3/lib/python3.6/site-packages
Requires: requests, numpy
Required-by:
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">openjij</span> <span class="k">as</span> <span class="nn">oj</span>
</pre></div>
</div>
</div>
<p>以下のように<code class="docutils literal notranslate"><span class="pre">SASampler</span></code> などを使う時と同じく CMOSAnnealer というコンストラクタで インスタンスを生成して sample_ising で解をサンプリングできます。ここでtoken には Annealing cloud web で取得した token を使ってください。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cmos</span> <span class="o">=</span> <span class="n">oj</span><span class="o">.</span><span class="n">CMOSAnnealer</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">iteration</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">J</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">cmos</span><span class="o">.</span><span class="n">sample_ising</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<span class="p">[{</span><span class="n">index</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">state</span><span class="p">)}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[{0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1}]
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">またAnnealing Cloud Web では ASIC実装とFPGA実装を提供しています。</div>
<div class="line">それらはCMOSAnnealerコンストラクタの引数の<code class="docutils literal notranslate"><span class="pre">machine_type</span></code>で指定します。 デフォルトはASICです。</div>
</div>
<p>FPGAとASICで扱えるパラメータ(問題サイズや相互作用の大きさの範囲)が違うことに注意してください。(詳細 : <a class="reference external" href="https://annealing-cloud.com/web-api/reference/v2.html">https://annealing-cloud.com/web-api/reference/v2.html</a>)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cmos</span> <span class="o">=</span> <span class="n">oj</span><span class="o">.</span><span class="n">CMOSAnnealer</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">iteration</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">machine_type</span><span class="o">=</span><span class="s2">&quot;FPGA&quot;</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">J</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">cmos</span><span class="o">.</span><span class="n">sample_ising</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<span class="p">[{</span><span class="n">index</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">state</span><span class="p">)}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[{0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1}]
</pre></div>
</div>
</div>
<div class="section" id="相互作用とキンググラフ">
<h3>相互作用とキンググラフ<a class="headerlink" href="#相互作用とキンググラフ" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="他のSamplerと同じ-辞書型で渡す">
<h2>他のSamplerと同じ 辞書型で渡す<a class="headerlink" href="#他のSamplerと同じ-辞書型で渡す" title="Permalink to this headline">¶</a></h2>
<p>上記のようにイジングの h と J を辞書型で渡すことができます。添字はCMOSアニーリングマシンの持つキンググラフ(<a class="reference external" href="https://annealing-cloud.com/play/ising-editor.html">こちらを参照</a>)の2次元格子(x, y)を左上から横に順番に番号をつけていった1次元添字(index)に対応させてください。</p>
<ul class="simple">
<li><p>2次元格子(キンググラフ上の座標)</p>
<ul>
<li><p>x軸 : 0 -&gt; Lx</p></li>
<li><p>y軸 : 0 -&gt; Ly</p></li>
</ul>
</li>
<li><p>1次元の添字</p>
<ul>
<li><p>index = x + Ly * y</p></li>
</ul>
</li>
</ul>
<p>例えば FPGA 実装であれば 2次元格子のx軸方向の範囲は 0-79 なので、{(0, 80): -1} という相互作用を渡せば、0番目のスピンとキンググラフ上で真下のスピンに -1 の結合ができます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cmos_fpga</span> <span class="o">=</span> <span class="n">oj</span><span class="o">.</span><span class="n">CMOSAnnealer</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">machine_type</span><span class="o">=</span><span class="s2">&quot;FPGA&quot;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">cmos_fpga</span><span class="o">.</span><span class="n">sample_ising</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="p">{},</span> <span class="n">J</span><span class="o">=</span><span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span>
<span class="p">[{</span><span class="n">index</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">state</span><span class="p">)}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[{0: 1, 80: 1}]
</pre></div>
</div>
</div>
<p>ASIC 上ではx軸方向の大きさが違うので (0, 80) の組み合わせは同じ行のスピンをしてしていることになり、キンググラフ上でつながっていないのでエラーになります。</p>
<p>以下のコードは繋がっていない変数同士を相互作用させようとしているので ValueError です。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cmos_fpga</span> <span class="o">=</span> <span class="n">oj</span><span class="o">.</span><span class="n">CMOSAnnealer</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">machine_type</span><span class="o">=</span><span class="s2">&quot;ASIC&quot;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">cmos_fpga</span><span class="o">.</span><span class="n">sample_ising</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="p">{},</span> <span class="n">J</span><span class="o">=</span><span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span> <span class="c1"># ValueError !!</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-7-6af0b52239d5&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> cmos_fpga <span class="ansi-blue-fg">=</span> oj<span class="ansi-blue-fg">.</span>CMOSAnnealer<span class="ansi-blue-fg">(</span>token<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;4217cf4d6928cfe72921e266ee3b655c&#34;</span><span class="ansi-blue-fg">,</span> machine_type<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;ASIC&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>response <span class="ansi-blue-fg">=</span> cmos_fpga<span class="ansi-blue-fg">.</span>sample_ising<span class="ansi-blue-fg">(</span>h<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">,</span> J<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">80</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># ValueError !!</span>

<span class="ansi-green-fg">/usr/local/miniconda3/lib/python3.6/site-packages/openjij/sampler/cmos_annealer.py</span> in <span class="ansi-cyan-fg">sample_ising</span><span class="ansi-blue-fg">(self, h, J, king_graph)</span>
<span class="ansi-green-intense-fg ansi-bold">     41</span>             <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sampling<span class="ansi-blue-fg">(</span>_king_graph<span class="ansi-blue-fg">,</span> spin_type<span class="ansi-blue-fg">=</span>spin_type<span class="ansi-blue-fg">,</span> token<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>token<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     42</span>         <span class="ansi-green-fg">elif</span> <span class="ansi-blue-fg">(</span>h <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">and</span> <span class="ansi-blue-fg">(</span>J <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 43</span><span class="ansi-red-fg">             </span>_king_graph <span class="ansi-blue-fg">=</span> KingGraph<span class="ansi-blue-fg">(</span>machine_type<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>machine_type<span class="ansi-blue-fg">,</span> h<span class="ansi-blue-fg">=</span>h<span class="ansi-blue-fg">,</span> J<span class="ansi-blue-fg">=</span>J<span class="ansi-blue-fg">,</span> spin_type<span class="ansi-blue-fg">=</span>spin_type<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     44</span>             <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sampling<span class="ansi-blue-fg">(</span>_king_graph<span class="ansi-blue-fg">,</span> spin_type<span class="ansi-blue-fg">=</span>spin_type<span class="ansi-blue-fg">,</span> token<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>token<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     45</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/miniconda3/lib/python3.6/site-packages/openjij/model/king_graph.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, machine_type, h, J, Q, king_graph, spin_type)</span>
<span class="ansi-green-intense-fg ansi-bold">     86</span>                     self<span class="ansi-blue-fg">.</span>_ising_king_graph<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>x1<span class="ansi-blue-fg">,</span> y1<span class="ansi-blue-fg">,</span> x2<span class="ansi-blue-fg">,</span> y2<span class="ansi-blue-fg">,</span> ising_int<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span>j<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     87</span>
<span class="ansi-green-fg">---&gt; 88</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_validation_ising_king_graph<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     89</span>
<span class="ansi-green-intense-fg ansi-bold">     90</span>     <span class="ansi-green-fg">def</span> _convert_to_BQM_format<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> king_graph<span class="ansi-blue-fg">,</span> spin_type<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/miniconda3/lib/python3.6/site-packages/openjij/model/king_graph.py</span> in <span class="ansi-cyan-fg">_validation_ising_king_graph</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>             <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> <span class="ansi-blue-fg">(</span>xi <span class="ansi-green-fg">in</span> <span class="ansi-blue-fg">[</span>xj<span class="ansi-blue-fg">,</span> xj<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> xj<span class="ansi-blue-fg">+</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">or</span> <span class="ansi-green-fg">not</span> <span class="ansi-blue-fg">(</span>yi <span class="ansi-green-fg">in</span> <span class="ansi-blue-fg">[</span>yj<span class="ansi-blue-fg">,</span> yj<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> yj<span class="ansi-blue-fg">+</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    128</span>                 raise ValueError(&#39;Graph is incomplete xi: {}, yi: {}, xj: {}, yj: {}, p:{}&#39;
<span class="ansi-green-fg">--&gt; 129</span><span class="ansi-red-fg">                 .format(xi, yi, xj, yj, p))
</span><span class="ansi-green-intense-fg ansi-bold">    130</span>             <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> <span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>prange<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">&lt;=</span> p <span class="ansi-blue-fg">&lt;=</span> self<span class="ansi-blue-fg">.</span>prange<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    131</span>                 raise ValueError(&#39;Graph is incomplete xi: {}, yi: {}, xj: {}, yj: {}, p: {}&#39;

<span class="ansi-red-fg">ValueError</span>: Graph is incomplete xi: 0, yi: 0, xj: 80, yj: 0, p:-1
</pre></div></div>
</div>
</div>
<div class="section" id="キンググラフ上の2次元座標で相互作用を渡す">
<h2>キンググラフ上の2次元座標で相互作用を渡す<a class="headerlink" href="#キンググラフ上の2次元座標で相互作用を渡す" title="Permalink to this headline">¶</a></h2>
<p>また入力はAnnealing Cloud Web の入力フォーマットでも行えます。その際は king_graph という引数に渡してください。</p>
<p>Annealing Cloud Webの入力フォーマットは２次元格子の座標を指定します。</p>
<ul class="simple">
<li><p>Linear term : [x1, y1, x1, y1, value]</p></li>
<li><p>Quadratic term : [x1, y1, x2, y2, value]</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cmos</span> <span class="o">=</span> <span class="n">oj</span><span class="o">.</span><span class="n">CMOSAnnealer</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">iteration</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">machine_type</span><span class="o">=</span><span class="s2">&quot;FPGA&quot;</span><span class="p">)</span>

<span class="n">king_graph</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="c1"># ↑は</span>
<span class="c1"># h = {0: 1}</span>
<span class="c1"># J = {(0, 1): -1, (1, 2): -1}</span>
<span class="c1"># とおなじ</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">cmos</span><span class="o">.</span><span class="n">sample_ising</span><span class="p">(</span><span class="n">king_graph</span> <span class="o">=</span> <span class="n">king_graph</span><span class="p">)</span>
<span class="p">[{</span><span class="n">index</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">state</span><span class="p">)}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[{0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1},
 {0: -1, 1: -1, 2: -1}]
</pre></div>
</div>
</div>
</div>
<div class="section" id="QUBOを解く">
<h2>QUBOを解く<a class="headerlink" href="#QUBOを解く" title="Permalink to this headline">¶</a></h2>
<p>実用的には 0, 1 変数で解きたいことが多いです。その時は他のSamplerと同じく sample_qubo を使えば良いです。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cmos_fpga</span> <span class="o">=</span> <span class="n">oj</span><span class="o">.</span><span class="n">CMOSAnnealer</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">machine_type</span><span class="o">=</span><span class="s2">&quot;FPGA&quot;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">cmos_fpga</span><span class="o">.</span><span class="n">sample_qubo</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span><span class="o">-</span><span class="mi">4</span><span class="p">})</span>
<span class="p">[{</span><span class="n">index</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">state</span><span class="p">)}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[{0: 1, 80: 1}]
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="3-PyQUBO_2_OpenJij.html" title="3-PyQUBO with OpenJij"
             >next</a> |</li>
        <li class="right" >
          <a href="2-Evaluation_errorbar.html" title="ベンチマーク関数 標準誤差機能 の使い方"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OpenJij Tutorial  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >OpenJij チュートリアル</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, OpenJij.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>